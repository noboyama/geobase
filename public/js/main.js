/// <reference path="./../../node_modules/@types/jquery/index.d.ts" />
/// <reference path="./../../node_modules/@types/jqueryui/index.d.ts" />
/// <reference path="./../../node_modules/@types/leaflet/index.d.ts" />
var g_Map = null;
var g_Geojson = null;
var GeoData2 = (function () {
    // コンストラクター
    function GeoData2() {
        this.layerData = new Array();
    }
    GeoData2.prototype.setLeyer = function (feature, layer) {
        var id = this.layerData.length;
        this.layerData.push({ id: id, feature: feature, layer: layer });
    };
    GeoData2.prototype.viewPopup = function (elm) {
        var feature = elm["feature"];
        var layer = elm["layer"];
        try {
            var popup = layer.getPopup();
            popup.openPopup();
        }
        catch (Exception) {
            popup = layer.bindPopup(feature.properties.name, { maxWidth: 500, closeOnClick: false });
            popup.openPopup();
        }
    };
    GeoData2.prototype.renderProperty = function (elm) {
        $(this.propertyDiv).empty();
        var feature = elm["feature"];
        if (feature != null) {
            for (var key in feature.properties) {
                $("<div class='line' >"
                    + "<div class='name' >" + key + "</div>"
                    + "<div class='value'>" + feature.properties[key] + "</div>"
                    + "</div>")
                    .appendTo(this.propertyDiv);
            }
        }
    };
    GeoData2.prototype.find = function (leaflet_id) {
        var ret = null;
        this.layerData.forEach(function (elm, idx) {
            if (elm["id"] == leaflet_id) {
                ret = elm;
                return;
            }
        });
        return ret;
    };
    GeoData2.prototype.renderList = function (xList, xProperty) {
        var _self = this;
        _self.propertyDiv = xProperty;
        $(xList).addClass("geodata_list");
        this.layerData.forEach(function (elm, idx) {
            var id = elm["id"];
            var feature = elm["feature"];
            $("<div item_id='" + id + "' class='selectee line' >" + feature.properties.name + "</div>")
                .appendTo(xList);
        });
        $(xList).selectable({ "selected": function (e, ui) {
                //$("#WayList .selected").removeClass("selected") ;
                var temp = $(ui.selected);
                var id = $(temp[0]).attr("item_id");
                var item = _self.find(Number(id));
                if (item != null) {
                    _self.viewPopup(item);
                    _self.renderProperty(item);
                }
            }
        });
    };
    return GeoData2;
}());
var LeafLetMap = (function () {
    // コンストラクター
    function LeafLetMap(sElemntID, sfile) {
        if (sfile === void 0) { sfile = null; }
        this.sJsonFile = null;
        this.sMapUrl = 'http://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png';
        this.sJsonFile = sfile;
        this.initLeaflet(sElemntID);
    }
    LeafLetMap.prototype.initLeaflet = function (sElemntID) {
        this.map = L.map(sElemntID);
        /* Add  Map layer  */
        L.tileLayer(this.sMapUrl, {
            attribution: "<a href='http://maps.gsi.go.jp/development/ichiran.html' target='_blank'>地理院タイル</a>"
        }).addTo(this.map);
        // 指定ファイルがあれば読み込む、なければAPI発行
        var url = "";
        if (this.sJsonFile == null)
            url = "./api/get";
        else
            url = this.sJsonFile;
        this.loadLayer(url);
        this.map.setView([35.3622222, 138.7313889], 10);
        $('#gpx_file').change(function () {
            var file = $(this).prop('files')[0];
            var pattern = /(.+)(\.[^.]+$)/;
            //「image-test」と表示されます
            var name = file.name.match(pattern)[1];
            $('#gpx_name').val(name);
        });
    };
    LeafLetMap.prototype.loadLayer = function (url) {
        var _this = this;
        if (this.map == null)
            return;
        $.getJSON(url, function (data) {
            if (data == null || data.length == 0) {
                _this.geojson = null;
                alert("データが登録されていません");
                return;
            }
            var html = "";
            _this.geoData = new GeoData2();
            _this.geojson = L.geoJson(data, {
                color: "#000000",
                opacity: 0.7,
                onEachFeature: function (feature, layer) {
                    if (_this.geoData != null) {
                        _this.geoData.setLeyer(feature, layer);
                    }
                }
            });
            _this.map.fitBounds(_this.geojson.getBounds());
            _this.geojson.addTo(_this.map);
            _this.geoData.renderList($("#WayList"), $("#Property"));
        });
    };
    LeafLetMap.prototype.gpxUpload = function () {
        var _this = this;
        if (this.map == null)
            return;
        var name = $("#gpx_name").val();
        if (this.geojson != null) {
            this.map.removeLayer(this.geojson);
        }
        $("#WayList").empty();
        $("#Property").empty();
        this.geoData = null;
        var telm = $('#gpx_upload').get(0);
        var fd = new FormData(telm);
        $.ajax({
            url: "/post/gpxfileupload?name=" + name,
            type: "POST",
            data: fd,
            processData: false,
            contentType: false,
            dataType: 'json'
        })
            .done(function (data) {
            var url = "./api/get";
            _this.loadLayer(url);
        });
        return false;
    };
    return LeafLetMap;
}());

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUNyQixLQUFJLENBQUMsU0FBUyxDQUFFLEdBQUcsQ0FBRSxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxDQUFDO1FBQ0osTUFBTSxDQUFDLEtBQUssQ0FBQztJQUNkLENBQUM7SUFDRixpQkFBQztBQUFELENBNUZBLEFBNEZDLElBQUEiLCJmaWxlIjoicHVibGljL2pzL21haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi8uLi8uLi9ub2RlX21vZHVsZXMvQHR5cGVzL2pxdWVyeS9pbmRleC5kLnRzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vLi4vLi4vbm9kZV9tb2R1bGVzL0B0eXBlcy9qcXVlcnl1aS9pbmRleC5kLnRzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vLi4vLi4vbm9kZV9tb2R1bGVzL0B0eXBlcy9sZWFmbGV0L2luZGV4LmQudHNcIiAvPlxyXG5cclxudmFyIGdfTWFwID0gbnVsbCA7XHJcbnZhciBnX0dlb2pzb24gPSBudWxsIDtcclxuXHJcblxyXG5jbGFzcyBHZW9EYXRhMiB7XHJcblx0cHJpdmF0ZSBsYXllckRhdGEgOiBhbnlbXSA7XHJcblx0cHJpdmF0ZSBwcm9wZXJ0eURpdiA6IGFueSAgO1xyXG5cdCAvLyDjgrPjg7Pjgrnjg4jjg6njgq/jgr/jg7xcclxuICAgIGNvbnN0cnVjdG9yKCAgKVxyXG4gICAge1xyXG5cdFx0dGhpcy5sYXllckRhdGEgPSBuZXcgQXJyYXkoKSA7XHJcblx0fVxyXG5cdHB1YmxpYyBzZXRMZXllciggZmVhdHVyZSA6IGFueSAsIGxheWVyIDogYW55IClcclxuXHR7XHJcblx0XHR2YXIgaWQgPSB0aGlzLmxheWVyRGF0YS5sZW5ndGggIDtcclxuXHRcdHRoaXMubGF5ZXJEYXRhLnB1c2goIHsgaWQgOiBpZCAsICBmZWF0dXJlOmZlYXR1cmUgLCBsYXllciA6IGxheWVyICB9KVxyXG5cdH1cclxuXHRwcml2YXRlIHZpZXdQb3B1cCggZWxtIDogYW55IClcclxuXHR7XHJcblx0XHR2YXIgZmVhdHVyZSA9ZWxtWyBcImZlYXR1cmVcIiBdICA7XHJcblx0XHR2YXIgbGF5ZXIgPWVsbVsgXCJsYXllclwiIF0gIDtcclxuXHRcdHRyeXtcclxuXHRcdFx0dmFyIHBvcHVwID0gbGF5ZXIuZ2V0UG9wdXAoKSA7XHJcblx0XHRcdHBvcHVwLm9wZW5Qb3B1cCggKTtcclxuXHRcdH1cclxuXHRcdGNhdGNoIChFeGNlcHRpb24gKXtcclxuXHRcdFx0cG9wdXAgPSBsYXllci5iaW5kUG9wdXAoIGZlYXR1cmUucHJvcGVydGllcy5uYW1lICwgIHttYXhXaWR0aDogNTAwLCBjbG9zZU9uQ2xpY2s6IGZhbHNlfSAgKTtcclxuXHRcdFx0cG9wdXAub3BlblBvcHVwKCApO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRwdWJsaWMgcmVuZGVyUHJvcGVydHkoIGVsbSA6IGFueSAgIClcclxuXHR7XHJcblx0XHQkKHRoaXMucHJvcGVydHlEaXYgKS5lbXB0eSgpIDtcclxuXHRcdHZhciBmZWF0dXJlID1lbG1bIFwiZmVhdHVyZVwiIF0gIDtcclxuXHRcdGlmKCAgZmVhdHVyZSAhPSBudWxsIClcclxuXHRcdHtcclxuXHRcdFx0Zm9yKCB2YXIga2V5IGluIGZlYXR1cmUucHJvcGVydGllcyApXHJcblx0XHRcdHtcclxuXHRcdFx0XHQkKCBcIjxkaXYgY2xhc3M9J2xpbmUnID5cIlxyXG5cdFx0XHRcdCAgICAgICsgXCI8ZGl2IGNsYXNzPSduYW1lJyA+XCIgKyBrZXkgK1wiPC9kaXY+XCJcclxuXHRcdFx0XHQgICAgICArIFwiPGRpdiBjbGFzcz0ndmFsdWUnPlwiICsgZmVhdHVyZS5wcm9wZXJ0aWVzW2tleV0gKyBcIjwvZGl2PlwiXHJcblx0XHRcdFx0ICtcIjwvZGl2PlwiIClcclxuXHRcdFx0XHRcdC5hcHBlbmRUbyggdGhpcy5wcm9wZXJ0eURpdiApO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdHB1YmxpYyBmaW5kKCBsZWFmbGV0X2lkIDogTnVtYmVyICl7XHJcblx0XHR2YXIgcmV0ID0gbnVsbCA7XHJcblx0XHR0aGlzLmxheWVyRGF0YS5mb3JFYWNoKCAoIGVsbSAsIGlkeCAgKSA9PiB7XHJcblx0XHRcdGlmKCBlbG1bXCJpZFwiXSA9PSBsZWFmbGV0X2lkIClcclxuXHRcdFx0e1xyXG5cdFx0XHRcdHJldCA9IGVsbSA7XHJcblx0XHRcdFx0cmV0dXJuIDtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0XHRyZXR1cm4gcmV0IDtcclxuXHR9XHJcblx0cHVibGljIHJlbmRlckxpc3QoIHhMaXN0IDogYW55ICwgeFByb3BlcnR5OiBhbnkpXHJcblx0e1xyXG5cdFx0dmFyIF9zZWxmID0gdGhpcyA7XHJcblx0XHRfc2VsZi5wcm9wZXJ0eURpdiA9IHhQcm9wZXJ0eSA7XHJcblx0XHQkKCB4TGlzdCApLmFkZENsYXNzKFwiZ2VvZGF0YV9saXN0XCIpO1xyXG5cdFx0dGhpcy5sYXllckRhdGEuZm9yRWFjaCggKCBlbG0gLCBpZHggICkgPT4ge1xyXG5cdFx0XHRcdHZhciBpZCA9IGVsbVsgXCJpZFwiIF0gIDtcclxuXHRcdFx0XHR2YXIgZmVhdHVyZSA9ZWxtWyBcImZlYXR1cmVcIiBdICA7XHJcblx0XHRcdFx0JCggXCI8ZGl2IGl0ZW1faWQ9J1wiK2lkICtcIicgY2xhc3M9J3NlbGVjdGVlIGxpbmUnID5cIiArIGZlYXR1cmUucHJvcGVydGllcy5uYW1lICsgXCI8L2Rpdj5cIiApXHJcblx0XHRcdFx0XHQuYXBwZW5kVG8oIHhMaXN0ICk7XHJcblx0XHR9KVxyXG5cdFx0JCggeExpc3QgKS5zZWxlY3RhYmxlKHsgXCJzZWxlY3RlZFwiIDogZnVuY3Rpb24oIGUsIHVpIClcclxuXHRcdFx0e1xyXG5cdFx0XHRcdC8vJChcIiNXYXlMaXN0IC5zZWxlY3RlZFwiKS5yZW1vdmVDbGFzcyhcInNlbGVjdGVkXCIpIDtcclxuXHRcdFx0XHR2YXIgdGVtcCA9ICQodWkuc2VsZWN0ZWQpO1xyXG5cdFx0XHRcdHZhciBpZCA9ICQodGVtcFsgMCBdKS5hdHRyKCBcIml0ZW1faWRcIikgO1xyXG5cdFx0XHRcdHZhciBpdGVtID0gX3NlbGYuZmluZCggTnVtYmVyKGlkKSApXHJcblx0XHRcdFx0aWYoIGl0ZW0gIT0gbnVsbCApXHJcblx0XHRcdFx0e1xyXG5cdFx0XHRcdFx0X3NlbGYudmlld1BvcHVwKCBpdGVtIClcclxuXHRcdFx0XHRcdF9zZWxmLnJlbmRlclByb3BlcnR5KCBpdGVtIClcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblxyXG59XHJcblxyXG5jbGFzcyBMZWFmTGV0TWFwIHtcclxuXHRwcml2YXRlIG1hcCA6IGFueSA7XHJcblx0cHJpdmF0ZSBnZW9qc29uIDogYW55IDtcclxuXHRwcml2YXRlIGdlb0RhdGEgOiBHZW9EYXRhMiA7XHJcblxyXG5cdHByaXZhdGUgIHNNYXBVcmwgOiBzdHJpbmcgO1xyXG5cclxuXHRwcml2YXRlIHNKc29uRmlsZSA6IHN0cmluZyA9IG51bGwgO1xyXG5cclxuICAgIC8vIOOCs+ODs+OCueODiOODqeOCr+OCv+ODvFxyXG4gICAgY29uc3RydWN0b3IoIHNFbGVtbnRJRCA6IHN0cmluZyAsIHNmaWxlIDogc3RyaW5nID0gbnVsbCApXHJcbiAgICB7XHJcblx0XHR0aGlzLnNNYXBVcmwgPSAnaHR0cDovL2N5YmVyamFwYW5kYXRhLmdzaS5nby5qcC94eXovcGFsZS97en0ve3h9L3t5fS5wbmcnIDtcclxuXHRcdHRoaXMuc0pzb25GaWxlID0gc2ZpbGUgO1xyXG5cdFx0dGhpcy5pbml0TGVhZmxldCggc0VsZW1udElEICkgO1xyXG4gICAgfVxyXG5cdHB1YmxpYyBpbml0TGVhZmxldCggc0VsZW1udElEICA6IHN0cmluZyApXHJcblx0e1xyXG5cclxuXHRcdHRoaXMubWFwID0gTC5tYXAoIHNFbGVtbnRJRCApO1xyXG5cdFx0LyogQWRkICBNYXAgbGF5ZXIgICovXHJcblx0XHRMLnRpbGVMYXllciggdGhpcy5zTWFwVXJsICAsIHtcclxuXHRcdFx0YXR0cmlidXRpb246IFwiPGEgaHJlZj0naHR0cDovL21hcHMuZ3NpLmdvLmpwL2RldmVsb3BtZW50L2ljaGlyYW4uaHRtbCcgdGFyZ2V0PSdfYmxhbmsnPuWcsOeQhumZouOCv+OCpOODqzwvYT5cIlxyXG5cdFx0fSkuYWRkVG8odGhpcy5tYXApO1xyXG5cdFx0Ly8g5oyH5a6a44OV44Kh44Kk44Or44GM44GC44KM44Gw6Kqt44G/6L6844KA44CB44Gq44GR44KM44GwQVBJ55m66KGMXHJcblx0XHR2YXIgdXJsID0gXCJcIiA7XHJcblx0XHRpZiggdGhpcy5zSnNvbkZpbGUgPT0gbnVsbCAgKSB1cmwgPSAgXCIuL2FwaS9nZXRcIiAgO1xyXG5cdFx0ZWxzZSB1cmwgPSB0aGlzLnNKc29uRmlsZSA7XHJcblx0XHR0aGlzLmxvYWRMYXllciggdXJsICk7XHJcblx0XHR0aGlzLm1hcC5zZXRWaWV3KFszNS4zNjIyMjIyLCAxMzguNzMxMzg4OV0sIDEwKTtcclxuXHJcblx0XHQkKCcjZ3B4X2ZpbGUnKS5jaGFuZ2UoZnVuY3Rpb24oKSB7XHJcblx0XHRcdHZhciBmaWxlID0gJCh0aGlzKS5wcm9wKCdmaWxlcycpWzBdO1xyXG5cdFx0XHR2YXIgcGF0dGVybiA9IC8oLispKFxcLlteLl0rJCkvO1xyXG5cdFx0XHQvL+OAjGltYWdlLXRlc3TjgI3jgajooajnpLrjgZXjgozjgb7jgZlcclxuXHRcdFx0dmFyIG5hbWUgID0gZmlsZS5uYW1lLm1hdGNoKHBhdHRlcm4pWzFdIDtcclxuXHRcdFx0JCgnI2dweF9uYW1lJykudmFsKCBuYW1lICk7XHJcblx0XHR9KTtcclxuXHR9XHJcblx0cHVibGljIGxvYWRMYXllciAoIHVybCA6IHN0cmluZyApICB7XHJcblx0XHRpZiggdGhpcy5tYXAgPT0gbnVsbCApICByZXR1cm4gO1xyXG5cclxuXHRcdCQuZ2V0SlNPTih1cmwsIChkYXRhKT0+IHtcclxuXHRcdFx0aWYoIGRhdGEgPT0gbnVsbCB8fCBkYXRhLmxlbmd0aCA9PSAwIClcclxuXHRcdFx0e1xyXG5cdFx0XHRcdCB0aGlzLmdlb2pzb24gID0gbnVsbCA7XHJcblx0XHRcdFx0YWxlcnQoIFwi44OH44O844K/44GM55m76Yyy44GV44KM44Gm44GE44G+44Gb44KTXCIgKSA7XHJcblx0XHRcdFx0cmV0dXJuIDtcclxuXHRcdFx0fVxyXG5cdFx0XHR2YXIgaHRtbCA9IFwiXCIgO1xyXG5cdFx0XHR0aGlzLmdlb0RhdGEgPW5ldyBHZW9EYXRhMiggKSAgO1xyXG5cdFx0XHR0aGlzLmdlb2pzb24gPSBMLmdlb0pzb24oIGRhdGEsIHtcclxuXHRcdFx0XHRjb2xvcjogXCIjMDAwMDAwXCIsXHJcblx0XHRcdFx0b3BhY2l0eTogMC43LFxyXG5cdFx0XHRcdG9uRWFjaEZlYXR1cmU6ICAoZmVhdHVyZSwgbGF5ZXIpID0+e1xyXG5cdFx0XHRcdFx0aWYoIHRoaXMuZ2VvRGF0YSAhPSBudWxsIClcclxuXHRcdFx0XHRcdHtcclxuXHRcdFx0XHRcdFx0dGhpcy5nZW9EYXRhLnNldExleWVyKCBmZWF0dXJlICwgbGF5ZXIgKSA7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSxcclxuXHJcblx0XHRcdH0pO1xyXG5cdFx0XHR0aGlzLm1hcC5maXRCb3VuZHMoIHRoaXMuZ2VvanNvbi5nZXRCb3VuZHMoKSk7XHJcblx0XHRcdHRoaXMuZ2VvanNvbi5hZGRUbyh0aGlzLm1hcCk7XHJcblx0XHRcdHRoaXMuZ2VvRGF0YS5yZW5kZXJMaXN0KCAkKFwiI1dheUxpc3RcIikgLCAkKFwiI1Byb3BlcnR5XCIpICk7XHJcblx0XHR9KTtcclxuXHR9XHJcblx0cHVibGljICBncHhVcGxvYWQoICkge1xyXG5cdFx0aWYoIHRoaXMubWFwID09IG51bGwgKSAgcmV0dXJuIDtcclxuXHRcdHZhciBuYW1lID0gJChcIiNncHhfbmFtZVwiKS52YWwoKSA7XHJcblx0XHRpZiggIHRoaXMuZ2VvanNvbiAgIT0gbnVsbCApe1xyXG5cdFx0XHR0aGlzLm1hcC5yZW1vdmVMYXllciggdGhpcy5nZW9qc29uICkgO1xyXG5cdFx0fVxyXG5cdFx0ICQoXCIjV2F5TGlzdFwiKS5lbXB0eSgpIDtcclxuXHRcdCAkKFwiI1Byb3BlcnR5XCIpLmVtcHR5KCkgO1xyXG5cdFx0IHRoaXMuZ2VvRGF0YSA9IG51bGwgO1xyXG5cdFx0IHZhciB0ZWxtIDogYW55ID0gJCgnI2dweF91cGxvYWQnKS5nZXQoMCkgO1xyXG5cdFx0dmFyIGZkID0gbmV3IEZvcm1EYXRhKCB0ZWxtICk744CAXHJcblx0XHQkLmFqYXgoe1xyXG5cdFx0XHRcdHVybDogXCIvcG9zdC9ncHhmaWxldXBsb2FkP25hbWU9XCIgKyBuYW1lICxcclxuXHRcdFx0XHR0eXBlOiBcIlBPU1RcIixcclxuXHRcdFx0XHRkYXRhOiBmZCxcclxuXHRcdFx0XHRwcm9jZXNzRGF0YTogZmFsc2UsXHJcblx0XHRcdFx0Y29udGVudFR5cGU6IGZhbHNlLFxyXG5cdFx0XHRcdGRhdGFUeXBlOiAnanNvbidcclxuXHRcdFx0fSlcclxuXHRcdFx0LmRvbmUoKGRhdGEpPT4ge1xyXG5cdFx0XHRcdHZhciB1cmwgPSBcIi4vYXBpL2dldFwiXHJcblx0XHRcdFx0dGhpcy5sb2FkTGF5ZXIoIHVybCApO1xyXG5cdFx0XHR9KTtcclxuXHRcdHJldHVybiBmYWxzZTtcclxuXHR9XHJcbn1cclxuXHJcbiJdfQ==
